<!DOCTYPE html>
<html lang="en">
  <head>
	<title>Web Worker 3</title>
	<meta charset="utf-8" />
	<style type='text/css'>
		canvas{border: 1px solid black;}
	</style>
	
  </head>
  <body>
	<div id="wrapper">
	
	<p>In this example I am running the Fibonacci series through a web worker.  The web worker runs on a separate thread thus allowing both processes to run simultaneously.  Also because I was using web workers I was able to have the result innerHTML show a "Waiting for web worker" message while the worker was processing then the number when it was done.</p>
	
	<div><input type="button" id="fibBtn" value="Start Fibonacci series" />&nbsp;
	<span id="result"></span></div>
	
	<canvas id="myCanvas" width="600" height="300">
		Canvas not supported
	</canvas>	
    
    </div>
    <script type="text/javascript" src="../js-objects/Animation.js"></script>
    <script>
        
        //create a new Worker instance.
        var fib = new Worker('webworker-scripts/fib-series.js');
        
        //create result variable
        var result = document.getElementById('result');
         
        //Here I post whatever gets returned from the web worker to the result innerHTML         
        fib.addEventListener('message',function(e){
			result.innerHTML = e.data;
		},false);
        
        //I have to send this to start the process
		//fib.postMessage();
		
		//When the button is clicked it displays the "Waiting for web worker..." message and send a number to the web worker.  When it is done computing the series it will return the result to  result.innerHTML.
		document.getElementById('fibBtn').addEventListener('click',function(){
			result.innerHTML = "Waiting for web worker....";
			fib.postMessage(45);
			
		},false);
		
		 //create a anim object
        var anim = new Animation("myCanvas");
        
        //get canvas
        var canvas = anim.getCanvas();
        
        //get context of canvas
        var context = anim.getContext();
        
        //get the linearSpeed of the box
        var linearSpeed = 1000//pixels/second
        
        //create the box (notice it is an object)
        var box = {
            x: 0,
            //center on canvas
            y: canvas.height / 2 - 25,
            width: 100,
            height: 50
        };
        
        var direction = 'right';
        //this is where we update the drawing
        anim.setStage(function(){
			var linearDistEachFrame = linearSpeed * this.getTimeInterval() /  2000;
			
			//check to see if the box hits the right edge of the canvas if so it stops the animation
			if (box.x < canvas.width - box.width && direction === 'right') {
				box.x += linearDistEachFrame;
			}
			else if (box.x > canvas.width - box.width && direction === 'right'){
				box.x -= linearDistEachFrame;
				direction = 'left';
			}
			else if (box.x < 0 && direction === 'left'){
				box.x += linearDistEachFrame;
				direction = 'right';
			}
			else{
				box.x -= linearDistEachFrame;
			}
			
			//clear (you have to clear the canvas prior to each redrawing)
			this.clear();
			
			//draw box in new position
			context.beginPath();
			context.fillStyle = "blue";
			context.fillRect(box.x, box.y, box.width, box.height);
			
		 });
        
        anim.start();
        
                
        
              
        </script>
  </body>
</html>
