<!DOCTYPE html>
<html lang="en">
  <head>
	<title>Web Worker 4</title>
	<meta charset="utf-8" />
	<style type='text/css'>
		canvas{border: 1px solid black;}
	</style>
	
  </head>
  <body>
	<div id="wrapper">
	
	<p>Web workers are able to handle AJAX requests. However, in this example I am running an AJAX request without a web worker and it works just fine. The reason is because the Fibonacci series is being run on the server, thus the JavaScript is not disrupted.  All the request does is wait for a callback from the server then display the result.</p>
	
	<div><input type="button" id="fibBtn" value="Start Fibonacci series" />&nbsp;
	<span id="result"></span></div>
		
    <canvas id="myCanvas" width="600" height="300">
		Canvas not supported
	</canvas>
    </div>
    <script type="text/javascript" src="../js-objects/Ajax.js"></script>
    <script type="text/javascript" src="../js-objects/Animation.js"></script>
    <script>
        document.getElementById('fibBtn').addEventListener('click',runFib,false);
        var result = document.getElementById('result');
        
        function runFib(){
			result.innerHTML = "Calculating series please wait...";
			Ajax.sendRequest('webworker-scripts/fib-series.php',handleRequest);
			function handleRequest(req){
				result.innerHTML = req.responseText;
			}
		}
        
        
        //create a anim object
        var anim = new Animation("myCanvas");
        
        //get canvas
        var canvas = anim.getCanvas();
        
        //get context of canvas
        var context = anim.getContext();
        
        //get the linearSpeed of the box
        var linearSpeed = 1000//pixels/second
        
        //create the box (notice it is an object)
        var box = {
            x: 0,
            //center on canvas
            y: canvas.height / 2 - 25,
            width: 100,
            height: 50
        };
        
        var direction = 'right';
        //this is where we update the drawing
        anim.setStage(function(){
                var linearDistEachFrame = linearSpeed * this.getTimeInterval() /  2000;
                
                //check to see if the box hits the right edge of the canvas if so it stops the animation
				if (box.x < canvas.width - box.width && direction === 'right') {
                    box.x += linearDistEachFrame;
                }
                else if (box.x > canvas.width - box.width && direction === 'right'){
                    box.x -= linearDistEachFrame;
                    direction = 'left';
                }
                else if (box.x < 0 && direction === 'left'){
					box.x += linearDistEachFrame;
					direction = 'right';
				}
				else{
					box.x -= linearDistEachFrame;
				}
                
                //clear (you have to clear the canvas prior to each redrawing)
                this.clear();
                
                //draw box in new position
                context.beginPath();
                context.fillStyle = "blue";
                context.fillRect(box.x, box.y, box.width, box.height);
                
             });
        
        anim.start();
        
        </script>
  </body>
</html>
